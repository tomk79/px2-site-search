<p>Welcome to Pickles 2.</p>

<?php if(isset($px)){ ?>
<ul><?php
$children = $px->site()->get_children();
foreach($children as $pid){
	print '<li>'.$px->mk_link($pid).'</li>'."\n";
}

?></ul>
<?php } ?>

<h2>検索</h2>
<div>
	<form action="javascript:;" method="get" id="cont-search-form">
		<input type="search" name="q" value="" class="px2-input" />
		<button class="px2-btn px2-btn--primary">検索</button>
	</form>
</div>
<div id="cont-search-result">
</div>

<script>
$(window).on('load', function(){
	let indexData = {};
	$.ajax({
		"url": "/caches/p/sitesearch/index.json",
		"success": function(data){
			indexData = data;
		},
	});
	$('#cont-search-form')
		.on('submit', function(e){
			const keyword = $(this).find('input[name=q]').val();
			const searchResult = indexData.contents.filter(function(row){
				if(row.title.indexOf(keyword) >= 0){
					return true;
				}
				if(row.content.indexOf(keyword) >= 0){
					return true;
				}
				return false;
			});
			console.log(searchResult);
			$ul = $('<ul>');
			searchResult.forEach(function(row){
				const $li = $('<li>');
				$li.append($('<a>')
					.text(row.title)
					.attr({
						"href": row.href,
					})
				);
				$ul.append($li);
			});
			$('#cont-search-result').html('').append($ul);
		});
});
</script>
